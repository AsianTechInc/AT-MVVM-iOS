#!/bin/bash

set -e

APP='RideShare'
CONFIG=$(echo "$1" | tr ':A-Z:' ':a-z:')

if [[ "$CONFIG" != 'adhoc' && "$CONFIG" != 'release' ]]; then
    echo 'Please input config `adhoc, release`.'
    exit 1
fi

if [[ "$CONFIG" == 'release' ]]; then
    CONFIG='Release'
else
    CONFIG='AdHoc'
fi

BUILD_DIR='./build'
SCHEME="$APP-$CONFIG"
IPA_NAME="$SCHEME.ipa"
IPA_PATH="$BUILD_DIR/$IPA_NAME"

rm -rf "$BUILD_DIR"

# Export IPA
gym --workspace "./$APP.xcworkspace" \
    --scheme "$SCHEME" \
    --include_bitcode true \
    --output_directory "$BUILD_DIR" \
    --output_name "$IPA_NAME" \
    --buildlog_path "$BUILD_DIR/gym.log" \
    --clean true \
    --silent false \
    --use_legacy_build_api true && echo "$IPA_PATH"
